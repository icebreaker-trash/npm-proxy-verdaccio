# 使用 Verdaccio 私有化 npm 源指南

- [使用 Verdaccio 私有化 npm 源指南](#使用-verdaccio-私有化-npm-源指南)
  - [介绍](#介绍)
  - [什么是 Verdaccio](#什么是-verdaccio)
  - [为什么选择 Verdaccio](#为什么选择-verdaccio)
  - [部署](#部署)
    - [一般部署](#一般部署)
    - [Docker 部署](#docker-部署)
  - [注册用户](#注册用户)
  - [项目使用私有源](#项目使用私有源)
    - [全量切换](#全量切换)
    - [部分切换](#部分切换)

## 介绍

在日常的工作开发中，我们常常会遇到这样的场景:

公司或团队内部，需要开发和共享一些逻辑/UI 组件等等的代码，

但是这些代码里面，可能包含一些敏感信息或专有功能，我们不想发布到公开的 npmjs 上去。

这时候我们就需要去搭建 npm 私有源，让这些包只在我们公司内部分享。

## 什么是 Verdaccio

Verdaccio 是一个轻量级的私有 npm 仓库管理工具，它可以帮助我们搭建自己的私有 npm 源。

在这种情况下，使用 Verdaccio 搭建私有 npm 源可以提供以下优势：

- 安全性：通过搭建私有 npm 源，您可以更好地控制和保护自己的代码。只有授权用户能够访问您的私有源，防止未经授权的人员获取敏感信息或篡改包。

- 灵活性：通过自定义配置 Verdaccio，您可以根据团队或公司的需求来管理包和版本发布。您可以设置访问权限、存储路径等参数，以满足特定项目的要求。

- 提高效率：拥有一个专门为团队开发定制的私有 npm 源意味着团队成员之间能够更快速地共享和管理代码。不需要依赖公共 npm 仓库下载、安装包，节省了时间和带宽消耗。

- 自定义功能：Verdaccio 支持插件机制，允许您扩展其功能，并集成其他服务（如 LDAP 或 GitHub）进行身份验证。这样就可以与现有系统集成，并实现更多定制化功能。

总而言之，在团队开发或者公司内部项目中使用 Verdaccio 私有化 npm 源是一种有效且灵活的方式来管理自定义包，并确保代码安全性与可靠性。通过搭建私有源, 团队能够更好地协作并加快项目进度。

## 为什么选择 Verdaccio

其实 npm 私有源目前开源主流只剩下了 Verdaccio，Nexus 这 2 个项目，还在继续维护，更新频率也高

作为一个这 2 个项目，都用过的开发者，为什么我更推荐 Verdaccio 呢？

1. 首先，它的社区生态生态好，插件层出不穷；而 Nexus 的开源版本就相形见绌不少（收费版没用过不知道）
2. 其次，它是 js 写的，我们前端开发者，可以很方便的编写插件，或者对它的源代码进行修改，添加我们自己的逻辑；而 Nexus 是 java 写的，需要一些学习成本
3. 再来，它的使用，以及包的发布，管理，预览方式非常像 npmjs，熟悉 npmjs 的使用它简直 0 成本；而 Nexus 界面，对包信息的展示，简直可以用简陋来形容。
4. 最后，其实它们 2 者关于 身份验证，权限控制 等等的功能都大差不差的。

当然有人肯定也会说，Nexus 多好啊，部署一份可以支持 maven, npm, docker, pypi... 这么多跨语言的团队，同时都可以使用呢！

诚然，假如你是一个 java 或者 运维人员，这样想是完全没有问题的。

但是，假如你是一名 前端/nodejs，在有主导权的情况下，我建议你选择 Verdaccio，

因为其实只有我们前端自己，最懂自己的使用需求。

Nexus 那种通用类型的私有包管理项目，注定照顾不了，每一个细分语言最佳的使用体验！！

## 部署

### 一般部署

### Docker 部署

## 注册用户

执行 `npm adduser --registry http://0.0.0.0:4873/`

按照顺序完成之后，会出现一个 `htpasswd` 文件

## 项目使用私有源

### 全量切换

在 `.npmrc` 里添加

```txt
registry=http://registry.npmmirror.com/
```

然后重新安装即可，可能需要删掉 `lock` 文件

### 部分切换

显式指明包在 npm 私有仓库中的的完整路径，（指明 tgz 包的版本）

```json
// package.json
{
  "dependencies": {
    "xxx": "http://xxxx"
  }
}
```

或者，可以在在 `.npmrc` 里显式指定特定包的特定注册源

```txt
xxxx:registry=http://xxxx

@xxx:registry=http://xxxx
```
